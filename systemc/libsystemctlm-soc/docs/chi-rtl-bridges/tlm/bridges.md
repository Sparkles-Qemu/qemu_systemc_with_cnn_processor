# CHI TLM HW Bridges

| Abbreviation | Explanation                   |
|--------------|-------------------------------|
| GP           | Generic Payload               |
| HWB          | Hardware Bridge               |
| TLM          | Transaction level modelling   |
| RN-F         | Request Node Fully coherent   |
| HN-F         | Home Node (all request types) |

## Overview

The TLM HW Bridges implement a SystemC TLM integration for RTL HW Bridges.
The purpose of these TLM modules is to on one side, act as a driver for the
HWB by issuing register reads/writes, receiving interrupts and setting
up DMA transactions. On the other side, these bridges expose the capabilities
of the HWB through TLM constructs such as TLM sockets and SystemC signals.

A more detailed description of how the HW bridges operate can be found in
[../../rtl-bridges/bridges.md](../../rlt-bridges).

## tlm2chi-hwb-rnf.h

The TLM2CHI RN-F HWB accepts TLM GPs (describing CHI flits for the REQ, DAT and
RSP TX channels) and by means of driving a HWB via TLM2VFIO injects the
equivalent flit on the HW side. The incoming TLM GPs (describing flits) are
expected to be in the format generated by
[cache-chi](../../../tlm-modules/cache-chi.h). The RN-F HWB also captures any
CHI flits on the RX channels through the HWB (and TLM2VFIO) and forwards these
as CHI TLM GPs to the TLM side (in the format expected by
[cache-chi](../../../tlm-modules/cache-chi.h)).


```
               ._______________.                     .__________.  ._____.
  REQ,DAT,RSP  |               |  TLM GP Reg-access  |          |  |     |
 ------------->|  TLM2CHI RN-F |<------------------->| TLM2VFIO |--| HWB |
 ------------->|      HWB      |       IRQs          |          |  |     |
 ------------->|               |                     |          |  |     |   CHI
  SNP,DAT,RSP  |               |                     |          |  |     | <----->
 <-------------|               |                     |          |  |     |
 <-------------|               |                     |          |  |     |
 <-------------|               |                     |          |  |     |
               `---------------'                     `----------'  `-----`
```

## chi2tlm-hwb-rnf.h

The CHI2TLM HN-F HWB captures any CHI flits on the HW side (REQ, RSP and DAT
channels) and converts those into TLM GPs (describing CHI flits). These
generated GPs are forwarded and injected into the TLM side and are in the
format expected by [iconnect-chi](../../../tlm-modules/iconnect-chi.h). The
HN-F HWB bridge also accepts incomming TLM GPs on the TLM side (describing SNP,
RSP and DAT flits) and injects the equivalent flit on the HW side TX channel
through the HWB (and TLM2VFIO).

```
               ._______________.                     ._____.
  SNP,DAT,RSP  |               |  TLM GP Reg-access  |     |
 ------------->|  CHI2TLM HN-F |<------------------->| HWB |
 ------------->|     HWB       |       IRQs          |     |
 ------------->|               |                     |     |   CHI
  REQ,DAT,RSP  |               |                     |     | <----->
 <-------------|               |                     |     |
 <-------------|               |                     |     |
 <-------------|               |                     |     |
               `---------------'                     `-----'
```

## HWB Usage examples

Inside the [CHI RTL bridge test directory](../../../tests/rtl-bridges/chi) a
VFIO test is found demonstrating how to connect the CHI HWB bridges. More
information about the tests can be found in the
[README.md](../../../tests/rtl-bridges/chi/README.md) located in the test
directory.

## cache-chi & iconnect-chi

More information about cache-chi and iconnect-chi can be found inside
[docs/components-chi.txt](../../components-chi.txt).
